/**
 * Created by dave on 6/3/16.
 */
//Globals
{
    var jsmediatags = window.jsmediatags;
    var env = {
        gActiveShow: null,
        gShows: {},
        gEpisodes: {}
    };
    var noartsrc = 'data:image/png;base64,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/GMzLdsAADuYaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzExMSA3OS4xNTgzMjUsIDIwMTUvMDkvMTAtMDE6MTA6MjAgICAgICAgICI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iCiAgICAgICAgICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICAgICAgICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChXaW5kb3dzKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxNi0wNi0wMVQxNjoyMToyMy0wNTowMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TWV0YWRhdGFEYXRlPjIwMTYtMDYtMDFUMTY6MjE6MjMtMDU6MDA8L3htcDpNZXRhZGF0YURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE2LTA2LTAxVDE2OjIxOjIzLTA1OjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDoyODYwYTkzNi1lNDliLWU1NDctOWI5Mi0zNzdkNzkyOTMyMTc8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnBob3Rvc2hvcDpiN2JlOTc3ZC0yODNlLTExZTYtOWNmYy1lYjFlMjA3Nzg5NWY8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDozNzliMTJhZi04MjNlLWQ1NDUtYmEyOS03YjQzN2VkOGMyZDY8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6Mzc5YjEyYWYtODIzZS1kNTQ1LWJhMjktN2I0MzdlZDhjMmQ2PC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTA2LTAxVDE2OjIxOjIzLTA1OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoV2luZG93cyk8L3N0RXZ0OnNvZnR3YXJlQWdlbnQ+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5zYXZlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOjI4NjBhOTM2LWU0OWItZTU0Ny05YjkyLTM3N2Q3OTI5MzIxNzwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxNi0wNi0wMVQxNjoyMToyMy0wNTowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICAgICA8c3RFdnQ6Y2hhbmdlZD4vPC9zdEV2dDpjaGFuZ2VkPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6U2VxPgogICAgICAgICA8L3htcE1NOkhpc3Rvcnk+CiAgICAgICAgIDxwaG90b3Nob3A6VGV4dExheWVycz4KICAgICAgICAgICAgPHJkZjpCYWc+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8cGhvdG9zaG9wOkxheWVyTmFtZT5DbGljayB0byBDaG9vc2UgQWxidW0gQXJ0PC9waG90b3Nob3A6TGF5ZXJOYW1lPgogICAgICAgICAgICAgICAgICA8cGhvdG9zaG9wOkxheWVyVGV4dD5DbGljayB0byBDaG9vc2UgQWxidW0gQXJ0PC9waG90b3Nob3A6TGF5ZXJUZXh0PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6QmFnPgogICAgICAgICA8L3Bob3Rvc2hvcDpUZXh0TGF5ZXJzPgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8cGhvdG9zaG9wOklDQ1Byb2ZpbGU+c1JHQiBJRUM2MTk2Ni0yLjE8L3Bob3Rvc2hvcDpJQ0NQcm9maWxlPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT4xPC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj4xMjg8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+MTI4PC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz4sl5n8AAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAA7+SURBVHja7F1bUxtHFm7LI4mRxUjyYDTYkbhJAgkJcDDBjo3tsITcNrfN5nGrtvaHbW3VPmxtJdlUKpU4cRxiG2PAGCMuhhgE6GKskfAgNFxaiCm8D8d0JpIQQhY2dvorP4zao57R+bpPn+7++nCksbERUbw4aKgJKAGUAApKACWAghJACaCgBFACKCgBlAAKSgAlgIISQAmgoARQAigOFsyB1m4VhOrqWpPFrNXqEELJlUQikXi0+HAlkSD3eLw+4zHj2vra1OREEY8wWywuVyNCaGbmV3W1f3QCHE5X6+ttLMuqC3meRwi1nWmXZXl25gFYvKa2jud5SZIIAR6vb211NRwKFvIgjjM1uN0IIVGMvowEHIgLOt958dz5C8T6GGNJkiRJUhRlx2pcTW1dzu96vL62M+2X3uoyWyzUBRVp/bp6B1xHImH/vRF1wwSnZK+pOSS/v4xlUxi/OgTYq2vA+oqiDA8NBmZnMm6IiWJMFO8MDdirc3MwNTkhPV7a3Nx8Dv6kjGXfee+Db/735atDgLe5BS7G/KPZ1lcjj4uPieLzafvvvPcBx3GvjgsyWywwzMqyXFxIA33o0ltdCKF//+uf6prbO84KQhV8VBQlGn2U4dzUeKPjHIzM83OB/r6b+a3/t7//AwofTE/fGRogT2x9vc1kMnMcpyhKMpkMLswX/aOeEwEVFSfgIrq4WNpYtqu7h2F+e1WGYWw2+3wgkJMAj9cH1o9EwntaP08goH4cz/M8zztdDT9e+a60Y0YpCTh+nIcLUYyWsNrOS2+B9THGU/cn11ZXjeXlniZvftvJsnz952u71Tk6crfO4bDZ7AihG7/0QqEsJyGAhhoURZmeur8sSTqdztXo5nme47iSjxmlJCC9lYYLnU5XwvkEhLNq/wBjddnvJxlq28my/OOV73arM4VxOBQkDi1jNGp9vQ2s//VXX5DGHpidufynbpvNznGcx+sroS8q5TxgWZKI0yh5rxof92fb8Xd38nx7x1mwXdGOwmyxAN/TU/czarj+8zWYx1RarYd0IhaPx+Ci6uSp0o5UkiTtaVBfcwt4qjH/aNFumuNMGY1JjWQyiRAyGI4dUgJSGEciYYQQy7LnOy+WsGYIrvJjYnwMWmhL6+ln74I5vahWqz3sSxH+eyNghbp6Rx4O7NU1BTK0tr6mds35HWDvtauKojAM09XdsycHy8tSztkJvL+r0Z39zhA4PY7HS2ixoxUVFaXsBKnU9vb2yZOnEEKW48ddDY06vV6n02+mN43l5ZVWoaHRfe5Cp8Pp2n7yZHbmAULI2dBoMBgwxvDRZDbX1NYihMb9owih1dXVhka3RqOxWgWNRrOysqIoShnLuhrdJpN5eVki94eCC48WHy7FY9U1tQzDVNfULsVj62tru72qsbwcvqjRaMRo1CoITU2+xcWHJpPJcvy4wWCwCsKyJKVSKQiu2jvOajQaRVGGBm9D4SFdC5qanEhvbrZ3nGUYhmVZ387cuGi3NuYfhdjG19yiru3B9HTOWXTvtaswb+jq7hnzj+4WsZARy9fc4vY0wfhxZ2hg5O5wxYlKjuMEoerDjz/N+NaYf7S0ayQHshoamJ35+qsv5ucCZPlTDYzxg+np27duFs7oQP8tnDWuEu+UkwPwRW1n2j1e327UDvTfkmUZplow1EP5j1e+ezA9nfHykiRd/eH7kk+Gjxz0ESWzxUJCC2h3RYcoVkHQ68v2XEoq7g1zVkhWDGU5eUCLg0foGbEXC7onTAmgBFBQAigBFJQASgAFJYASQEEJ+GPhwMW5DqfLZLaYTCaGYWRZ3traehyPh0ILRPxjFYS29g6E0Mjw0PNRBP0hCDBbLG9euJixkwUbGjzPN7jdGOO+G7/ERFGvL4PbyEIbJaAEDV+t5JFlOZlc2VhbN1nMBsMxoIFl2T+mxQ+cALPFQqwvy/LoyN2Mld4ylm10exxOF7X+gRDw5oWLYP1IJJxTGpXC2H9vxH9vJFvYQwl4Vtira8ChY4zzCNMIEzlrQAXs29irawrZk4FDBrvtpZSxbGXlU5FPztrIDZubqQMKEEpMgM1uh4up+5P7/e5xnn/j7DlyrEOSpN5rVzNoeKPjnL2mRn30IxwMqhVzZBBqbj1NtG8IIVGMjvtH1UZ0OF2wcQ0fQYjovzdCTH/2zfOgXSTPgqihtBYrsSrC19JqMBgQQv19N3NuCGeDyBqsVkGr1UqSpNPpNBqNwWDgKyrmAwFikQ8++uTUa6+pxTlarbbixInauvpQcIE8zuP1dV68bDSWq59iNJbXO5yKoiztiEq63u7R6/UwUOn1eo1GwzBaUGYghD746JPKykrCjUaj0Wq1eyotDlEYWsTGr6IovdeuxkSxjGU7L10WhCpBqLIKAjS6ru4eCJ9IWybNnOO4zkuXf/rhytNZxY60dsw/Oj8XQAjV1TtaWk/DHr30eCkmivbqp91o5O4w7LN7vD6iOfR4ffAscsKHdJfm1tPwoFdwJtzfdxNsncJ4YW4OCiFUtQoCDC3zc4GffrgCt8VE8acfroASWxCqwN03t54mXE5NTqQwTmE8NTnRe+0qVOhu8iKVJsXpagAJ19TkBBm04PyaoiiDt/th/AjMzkSjj+BBh3opYmNjnXjhZ6nn4cOI+mN1dS1c3M9ShQwPDaqtBmcUotFHGc46Joogm6yqOgkcQ+fgOK7n3ffPd15Uh2Rk/tjV3fP+hx/DP5PJXJKfdrAExGMxdUMruQfLjmdIiU6rQzsKn4219RyNY22d3AAdjki76uodf/7okwzLbm1tZXyEs56HOgqampzwNHlZlrXZ7KXV0ZOwMoMDYjVyOgEhZDDmEDBDoTo0uDM0MDPzKyyZsCzbeemtL//7H7iHYZjHj5f2jKQP4xhAIrm2M+27KWqtgvD2u++90XGuwDpDoQW4yK4QnD5CKPpoEe0czrHZ7BnN2SoIEFM+frwE0wjwOSuJxPfffgPuiGVZmIXAPdmVQPB62GfCgdkZqyDAYVVfc4vD6Yo+WoyJYjqdNpaXWywWUF4ihJKJlQLrjImiJEk8z9ts9rfffW9hbi6dTpOTQ2B3cPoPpqdhnOzq7oEDRjBy1judUBVofgWh6nznxbnZ2VBoIZlManfE6HBKadw/WtF9AtSlpBJjeTkc6s9/+vNQhKH9fTcTiQREfizL1tU7yNFtNdROY0/0XrsKJ+sgPFX/lyzLfTeukwntyN3htjPtDMNk64JH7g6TwZlhmAa3G47zASKRMPi3mCgODw2eO38hZyWHeiJGsBSPB2ZnmKOMTq+H+Q6BJEli9NGtvhvBhXn1RCwUXEgmf+sTLa2n1YWKooSCC8xR5pjRSOZiGOP5QACkuOpHx8ToMaNRPRcTxejtW33B+Xn4uL6xjp4gdVVwA6lneVnaWF83mc3k5THGohi9eb23hNp0RLWhLxx0S5ISQAmgoARQAigoAZQACkoAJYCCEkAJoHiOKHI11CoIPe++jxD69puvc6puSOq3G7/0guQGUrNl5F06PPj4L3/lOG43Mdmh6wFkx3HPJCYvBUgmlKqqk89Zr1cMAWUsSxRLNpv9FUhxW+d4ul3BMExzc+thJyDjFSF39ssLs8WiVsCRvbPiPPPzIABeUZZlyGBS73S+1DLbpp10KrCfzDDMbglW9rR+V3fPgQ/CHq8PlB2g4oPNv0a3h+zFF/KioPNJb6WDC/MZmaX1+rIMJWxGIUm/Eg4FSVWiGCXqWofTBan+1IV53ClsxMO+5qeffc4wjKfJm63nUL8G5MxX10/SZe43wcq+CXC6GhBCiqKAkgA2fh1OV4EE1Dud6m1Yt6dJnVOprb0DUtl//+035J6MQperkeRlJa6jwe2ORMKDt/vVGVmhMH9UU1fvIO0J0lnW1TtYlnU4XRmb7+Q1ggvzYOsGt1uSpMnxMWN5OUn0CrFf4fHe/lwQiRbCoSCo/uZmZxFCLMsW2G1JClbyse1M+26JvPPDZrNLkgR6N/j46WefQ6ZhSMMEhfkrhwSwiqJAIyDKu+yccQCDwdCyo35ECPE8D2oJ8kRpB7vlk3qmHkAaL3nR8XE/FDpdDYXIsGRZvj8xHpidMVssTV4fqCUa3O4iEjARXW0Zy4LrgHY3Pu5PYUx8giBU7VY5kehCM0IIrSQS0LF4ns95BIFlWTj2E4/HIBiZmpyYmpwg8x513y0xAWaLBfQgGGN15IMxZlmW47hCDk1EFxeha68kEv19N7U6nc1mL07xSvhOYZxMJnmeTyaTpNdPTU6Ae6zYUZlng+R6NxiPZavE6hyOnD9n8PYtGI1KMqPcBwEkWmBZVu3H1b9nvw35YfipHycy9OKQXElk5xYFVvK0J/K/6jBU7eKylZAY49Ke0SiUABItQC73bM/IsizP89lvnB/p9FNt1jOemNxKb+33K2QOn1NvC9y0vt6WMYZvbGy8mLUgEi3kTARJloay33iPgXTnSFMJk/AV2J5Ap54RcWUsDcHKxIH+jZNCo6CMaCEDoN3c78qEvbqGxOBPG/JWGvqT+raDSBjc6PZAewJ1XjZgllPEysR+J8MF9QCSQ55EC9mYHB+DMMDlaswzOlWdOgXDXUVlJXHB9yfG4WIpHheEKpZliQLX29xyEH9lBETOGOPdIjeis693OgsZbDc3n+oVm1tPL8zNvWa3V1ScuDM4sGfPLogAEhTPzPy62z3hUBDCoXqnMzvVPAHHcRkGHbk7TKY8v05PVdfUqhW4iqKAWr+E1vd4fdCewsF81pm6Pwnz/EIOOsREUZblnNrh/NhbnFvGsrV19RjjSCg0F5jNP6Iajh3b3NzcSqc3NtbNluMY40g4BMcKN9bXt7bS20+eKIqi1+tlWY7HYzev90bCIVIDUeDq9Prt7W1RjA4PDRw9enT7yZPkSgLuNFksen0ZyTUNgEJyD6DSalV/kaC2tv6IRoMxHhzoz3OUc3V1Vag6iTE+cgRFwqHdaiMIBRdSqZRGozl6lBHFaGB25uHDyJ5HRak49wWDbklSAigBFJQASgAFJYASQEEJoARQUAIoARSUAEoABSWAEkBBCaAEUFACKAEUlABKAAUlgBJAQQmgBFBQAigBFJQASgAFJYASQEEJoARQUAJebvx/AB+DeWveKCARAAAAAElFTkSuQmCC';

}

$(document).on('ready', function () {
    var elShowSelector = $(".navbar li#showSelector.dropdown");
    var elEpisodeGallery = $("div#episodeList.container");
    var elNewEpisodeForm = $('#newEpisodeForm');
    var elNewShowForm = $('#newShowForm');
    var elNewEpisodeFormOverlay = $('#newEpisodeForm.pageOverlay');
    var elNewShowFormOverlay = $('#newShowForm.pageOverlay');
    var elNewEpisodeFormWell = $('div#newEpisodeForm div.well');
    var elNewShowFormWell = $('div#newShowForm div.well');
    var elPageOverlay = $(".pageOverlay");
    var elMediaList = $('ul.media-list');
    var elButtonNewEpisode = $('button.newEpisode');
    var elButtonNewShow = $('a.newShow');
    var autoshortnamecheck = null;


    /* Build initial show drop-down selector and show initial episode list*/
    /* If there is a hash show id then load that show */
    if (window.location.hash) {
        //Get the show id from the hash
        var showid = window.location.hash.substring(1);

        getAllShows(showid);
    } else {
        getAllShows();
    }

    /* TODO: remove this - DEBUG: Clear any forms to make sure caching doesn't mess us up */
    clearForm('#newEpisodeForm');

    /* Form overlay toggle hooks debounced */
    resizeFormOverlays();
    $(window).smartresize(function () {
        resizeFormOverlays()
    });

    /* Set initial album art for new episode dialogue */
    elNewEpisodeForm.find('input#inputEpisodeAlbumArt').val(noartsrc);
    elNewEpisodeForm.find('img.albumart').attr('src', noartsrc);

    /* Episode publish button */
    elEpisodeGallery.on('click', 'a.btn-publish', function () {
        alert('test');
        //TODO: need ajax and verification here before marking as published
        $(this).parents('li.media').removeClass('unpublished').addClass('published');
        $(this).removeClass('btn-publish btn-success btn-default').addClass('btn-unpublish');
        $(this).text('Un-publish');
        $(this).siblings('.btn-delete').remove();
        $(this).blur();
    });

    /* Episode delete button */
    //TODO: episodes must be renumbered after one is deleted maybe - not sure - depends on publish status
    elEpisodeGallery.on('click', 'a.btn-delete', function () {
        var elEpisode = $(this).parent().parent();
        var number = elEpisode.data('number');
        
        //TODO: need ajax and verification here before removing
        deleteEpisode(getCurrentShowId(), number)
            .done(function (showId, episodeNumber) {
                elEpisode.remove();
            })
            .fail(function (msg) {
                showAlert(msg, false);
            });
        return false;
    });

    /* New show dialog */
    elNewShowForm.on('shown.bs.collapse', function () {
        $(this).find('input').first().focus();
    });
    elNewShowFormOverlay.find('button.save').on('click', function () {
        var title = elNewShowFormOverlay.find('input#inputShowTitle').val();
        var shortname = elNewShowFormOverlay.find('input#inputShowShortName').val();
        var link = elNewShowFormOverlay.find('input#inputShowLinkExternal').val();
        addNewShow(title, shortname, link)
            .done(function (show) {
                console.log("DEBUG: " + show);
                getAllShows();
                setActiveShow(show);
            })
            .fail(function (description) {
                alert(description);
            });
        closeOverlayForms();
        getAllShows();
        return false;
    });
    startAutoShortnameCheck();

    /* New episode dialog */
    elButtonNewEpisode.on('click', function () {
        $('#newEpisodeForm.pageOverlay input.episodeNumber').val(getNextEpisodeNumber());
    });
    elNewEpisodeFormOverlay.on('shown.bs.collapse', function () {
        $('#newEpisodeForm.pageOverlay input#inputEpisodeTitle').focus();
    });
    elNewEpisodeFormOverlay.find('button.save').on('click', function () {
        var showid = getCurrentShowId();
        var title = $('#newEpisodeForm.pageOverlay input#inputEpisodeTitle').val();
        var description = $('#newEpisodeForm.pageOverlay textarea#inputEpisodeDescription').val();
        var explicit = $('#newEpisodeForm.pageOverlay input#inputEpisodeExplicit').val();
        var albumart = $('#newEpisodeForm.pageOverlay img.albumart').attr('src');
        var epnumber = $('#newEpisodeForm.pageOverlay input.episodeNumber').val();
        var link = $('#newEpisodeForm.pageOverlay input#inputEpisodeLinkExternal').val();
        var mp3url = '#';

        if (!title) {
            alert("Each episode must have at least a title.");
            return false;
        }

        addNewEpisode(showid, epnumber, title, link, description, explicit, albumart, mp3url, false)
            .done(function (episodeid) {
                showBuilder.showAlert("Episode added", true);
                setActiveShow(env.gActiveShow);
            })
            .fail(function (msg) {
                showBuilder.showAlert(msg);
            });
        $('button.newEpisode').trigger('click');
        clearForm('#newEpisodeForm');
    });
    elNewEpisodeFormOverlay.find('button.savepublish').on('click', function () {
        var showid = getCurrentShowId();
        var title = $('#newEpisodeForm.pageOverlay input#inputEpisodeTitle').val();
        var description = $('#newEpisodeForm.pageOverlay textarea#inputEpisodeDescription').val();
        var explicit = $('#newEpisodeForm.pageOverlay input#inputEpisodeExplicit').val();
        var albumart = $('#newEpisodeForm.pageOverlay img.albumart').attr('src');
        var epnumber = $('#newEpisodeForm.pageOverlay input.episodeNumber').val();
        var link = $('#newEpisodeForm.pageOverlay input#inputEpisodeLinkExternal').val();
        var mp3url = '#';

        if (!title) {
            alert("Each episode must have a title and an mp3 file.");
            return false;
        }

        addNewEpisode(showid, epnumber, title, link, description, explicit, albumart, mp3url, true)
            .done(function (episodeid) {
                showBuilder.showAlert("Episode added", true);
                setActiveShow(getCurrentShowId());
            })
            .fail(function (msg) {
                showBuilder.showAlert(msg);
            });
        $('button.newEpisode').trigger('click');
        clearForm('#newEpisodeForm');
    });
    elNewEpisodeForm.find('input.mp3[type="file"]').on('change', function (event) {
        var file = event.target.files[0];
        var buttonspan = $('div#newEpisodeForm label.btn-file').find('span');

        if (file) {
            console.log("DEBUG: Filename -> " + file.name);
            buttonspan.html('<i class="fa fa-spinner fa-spin fa-fw"></i>Loading...');
            loadFromFile(file);
        } else {
            console.log("DEBUG: File picker cancelled.");
        }
        buttonspan.text("Choose mp3...");
    });
    elNewEpisodeForm.find('input.albumart[type="file"]').on('change', function () {
        var file = $(this)[0].files[0];
        if (file && isImage(file.name)) {
            console.log("DEBUG: Filename -> " + file.name);
            loadImageFileAsURL(file);
        } else {
            console.log("DEBUG: File picker cancelled.");
        }
    });

    /* Handle drag-drop into new episode form */
    elNewEpisodeFormWell.find('*').on('dragenter', function (e) {
        $(this).addClass('dragging-over');
    });
    elNewEpisodeFormWell.find('*').on('dragleave', function (e) {
        $(this).removeClass('dragging-over');
    });
    elNewEpisodeFormWell.on('dragover', function (e) {
        e.preventDefault();
        e.stopPropagation();

        //Change style on well to indicate ready
        $('div#newEpisodeForm div.well').css('background-color', '#def');
    });
    elNewEpisodeFormWell.on('dragenter', function (e) {
        e.preventDefault();
        e.stopPropagation();

        //Change style on well to indicate ready
        $('div#newEpisodeForm div.well').css('background-color', '#def');
    });
    elNewEpisodeFormWell.on('dragleave', function (e) {
        e.preventDefault();
        e.stopPropagation();

        //Change style on well to indicate non-ready
        $('div#newEpisodeForm div.well').css('background-color', '');
    });
    elNewEpisodeFormWell.on('drop', function (e) {
        loadFromFile(e.originalEvent.dataTransfer.files[0]);
        $('div#newEpisodeForm div.well').css('background-color', '');
        $('div#newEpisodeForm div.well').find('> *').removeClass('dragging-over');
        return false;
    });


    /* Handle drag-drop into the body which should open the new episode form if it's hidden */
    $('body').on('dragenter', function (e) {
        e.preventDefault();
        e.stopPropagation();

        //Change style on well to indicate ready
        if (!$('#newEpisodeForm').is(':visible')) {
            $('button.newEpisode').trigger('click');
        }
    });


    //-----------------------------------
    //Functions -------------------------
    //-----------------------------------

    //Start auto
    function startAutoShortnameCheck() {
        $(document).on('keyup', 'input#inputShowShortName', function () {

            clearTimeout(autoshortnamecheck);

            autoshortnamecheck = setTimeout(function () {
                var shortname = $('input#inputShowShortName').val();
                console.log("shortname check: " + shortname);
                checkShortname(shortname);
            }, 3000);
        })
    }

    function checkShortname(shortname) {
        headShortname(shortname)
            .done(function (msg) {
                showBuilder.showAlert("Shortname is available.", true);
            })
            .fail(function (msg) {
                showBuilder.showAlert("Shortname is taken.");
            })
    }

    function headShortname(shortname) {
        var authToken = getAuthToken();
        var deferredObject = $.Deferred();
        //Ajax call
        $.ajax({
            method: "HEAD",
            url: "/api/v1/shortname/" + shortname,
            headers: {
                'X-AuthToken': authToken
            }
        })
            .done(function (responseData) {
                if (responseData.status) {
                    deferredObject.reject(responseData.description);
                } else {
                    deferredObject.resolve(responseData.description);
                }
            })
            .fail(function (responseData) {
                deferredObject.resolve(responseData.description);
            });
        //Return a promise
        return deferredObject.promise();
    }

    function closeOverlayForms() {
        elPageOverlay.collapse('hide');
    }

    function resizeFormOverlays() {
        elPageOverlay.css("min-height", $(window).height());
        elPageOverlay.css("min-width", $(window).width());
    }

    function addNewEpisode(showid, number, title, link, description, explicit, arturl, mp3url, published) {
        console.log("addNewEpisode(" + showid + "," + title + "," + link + ")");
        var authToken = getAuthToken();
        var deferredObject = $.Deferred();
        //Ajax call
        $.ajax({
            method: "PUT",
            url: "/api/v1/episode/" + showid + "/" + number,
            dataType: 'json',
            data: {
                "title": title,
                "link": link,
                "description": description,
                "albumart": arturl,
                "explicit": explicit,
                "mediafile": mp3url,
                "published": published
            },
            headers: {
                'X-AuthToken': authToken
            }
        })
            .done(function (responseData) {
                console.log("addNewEpisode()->ajax returned");
                if (responseData.status) {
                    deferredObject.resolve(responseData);
                } else {
                    deferredObject.reject(responseData.description);
                }
            })
            .fail(function (ajaxobj, responseData, err) {
                console.log("addNewEpisode()->ajax returned fail code: " + ajaxobj.responseText);
                var response = JSON.parse(ajaxobj.responseText);
                deferredObject.reject(response.description);
            });
        //Return a promise
        return deferredObject.promise();
    }

    function addNewShow(title, shortname, link) {
        console.log("addNewShow(" + title + "," + shortname + "," + link + ")");
        var authToken = getAuthToken();
        var deferredObject = $.Deferred();
        //Ajax call
        $.ajax({
            method: "POST",
            url: "/api/v1/show",
            dataType: 'json',
            data: {
                "title": title,
                "shortname": shortname,
                "link": link
            },
            headers: {
                'X-AuthToken': authToken
            }
        })
            .done(function (responseData) {
                if (responseData.status) {
                    deferredObject.resolve(responseData);
                } else {
                    deferredObject.reject(responseData.description);
                }
            });
        //Return a promise
        return deferredObject.promise();
    }

    function getAllShows(showid) {
        showLoadingScreen();

        console.log("getAllShows(" + showid + ")");
        var elShowArea = $('div.section.showarea');
        var elNoShows = $('div.section.noshows');
        getShows()
            .done(function (showcount, shows) {
                if (showcount > 0) {
                    console.log("Make the show area visible.");
                    elShowArea.removeClass('hidden');
                    elNoShows.addClass('hidden');
                }

                env.gShows = shows;
                buildShowSelector(elShowSelector, shows[0], shows);

                if (typeof showid !== "undefined") {
                    for (i = 0; i < shows.length; i++) {
                        if (shows[i]._id == showid) {
                            setActiveShow(shows[i]);
                            break;
                        }
                    }
                } else {
                    setActiveShow(shows[0]);
                }
                hideLoadingScreen();
            })
            .fail(function (showcount, description) {
                console.log("Error getting shows: " + description);
                if (showcount === 0) {
                    elButtonNewShow.trigger('click');
                    elShowArea.addClass('hidden');
                    elNoShows.removeClass('hidden');
                }
                hideLoadingScreen();
            });
    }

    function getShows() {
        var authToken = getAuthToken();
        var deferredObject = $.Deferred();
        //Ajax call
        $.ajax({
            method: "GET",
            url: "/api/v1/shows",
            headers: {
                'X-AuthToken': authToken
            }
        })
            .done(function (responseData) {
                if (responseData.status) {
                    deferredObject.resolve(responseData.count, responseData.shows);
                } else {
                    deferredObject.reject(responseData.count, responseData.description);
                }
            });
        //Return a promise
        return deferredObject.promise();
    }

    function buildShowSelector(elDropdownParent, activeshow, shows) {
        var elDropdownList = elDropdownParent.find('ul.showSelector.dropdown-menu');
        var elCurrentLink = elDropdownParent.find('a#dropdownShowSelector');
        var elCurrentTitle = elCurrentLink.find('span.showTitle');

        closeOverlayForms();

        //Remove shows from dropdown
        elDropdownList.find('li.showSelector').remove();

        //Set current show to first in the list
        elCurrentLink.data('mediarow', activeshow._id);
        elCurrentLink.data('link', activeshow.link);
        elCurrentTitle.html(' ' + activeshow.title);

        //Build the episode gallery
        setActiveShow(activeshow);

        //Set the current show's feed url on the page button
        setCurrentFeedUrl(activeshow.feedurl);

        //Populate with new shows
        for (var i = 0; i < shows.length; i++) {
            //Don't list the show that's active
            if (shows[i]._id !== activeshow._id) {
                elDropdownList.prepend('<li id ="aShowSelector' + i + '" class="showSelector"> <a href="#">' + shows[i].title + '</a> </li>');
                elDropdownList.find('li#aShowSelector' + i + '.showSelector').data('show', shows[i]);
            }
        }

        //Set click actions on the items
        elDropdownList.find('li.showSelector').on('click', function () {
            var show = $(this).data('show');
            var title = show.title;
            var id = show._id;

            //Rebuild the show selector to exclude the now selected show
            buildShowSelector(elDropdownParent, show, shows);

            //Set the properties on the

            $('.showSelector').removeClass('hide');
            $(this).addClass('hide');

            window.location.hash = id;
            elDropdownList.dropdown('toggle');
            return false;
        });

    }

    function getEpisodes(show) {
        var authToken = getAuthToken();
        var deferredObject = $.Deferred();
        //Ajax call
        $.ajax({
            method: "GET",
            url: "/api/v1/episodes/" + show._id,
            headers: {
                'X-AuthToken': authToken
            }
        })
            .done(function (responseData) {
                if (responseData.status) {
                    env.gEpisodes = responseData.episodes;
                    deferredObject.resolve(responseData.count, responseData.episodes);
                } else {
                    deferredObject.reject(responseData.description);
                }
            });
        //Return a promise
        return deferredObject.promise();
    }

    function setActiveShow(show) {
        console.log("setActiveShow(" + show + ")");
        getEpisodes(show)
            .done(function (count, episodes) {
                console.log("Success...");
                env.gActiveShow = show;
                env.gEpisodes = episodes;
                buildEpisodeGallery(elEpisodeGallery, show, episodes);
            })
            .fail(function (msg) {
                console.log("Error getting shows: " + msg);
                showBuilder.showAlert(msg, false);
                gEpisodes()
                buildEpisodeGallery(elEpisodeGallery, show, {});
            });
    }

    function buildEpisodeGallery(elEpisodeGallery, show, episodes) {
        removeMediaRowsFromEpisodeGallery(elEpisodeGallery);

        closeOverlayForms();

        if (episodes.length == 0) {
            //Open the new episode form
            elButtonNewEpisode.trigger('click');
            elEpisodeGallery.append('<div class="row mediarow"><div class="col-md-12 text-center"><p>This show has no episodes yet. Get busy!</p></div></div>');

            return false;
        }

        //Each show has a mediarow div and a ul list
        elEpisodeGallery.append('<div class="row mediarow ' + show._id + '"><div class="col-md-12"><ul class="media-list"></ul></div></div>');
        var elEpisodeList = elEpisodeGallery.find('.mediarow.' + show._id + ' ul.media-list');

        //Now iterate the episodes in this show
        for (i = 0; i < episodes.length; i++) {
            var episode = episodes[i];

            //Add the media block itself for this episode
            elEpisodeList.append('<li class="media episode' + episode.number + '" data-number="' + episode.number + '" data-id="' + episode._id + '"></li>');
            var elEpisode = elEpisodeList.find('li.media.episode' + episode.number);

            //Note if it's published or not
            if (episode.published) {
                elEpisode.addClass('published');
            } else {
                elEpisode.addClass('unpublished');
            }

            //Add the album art with a link
            elEpisode.append('<a class="pull-left albumart" href="#"><img class="media-object albumart" src="' + episode.albumart + '"></a>');

            //Add a body for this media item
            elEpisode.append('<div class="media-body"></div>');
            var elEpisodeBody = elEpisode.find('.media-body');

            //Add a modified date
            elEpisodeBody.append('<h4 class="pull-right hidden-xs media-date"><small>' + dateModified(episode.dateModified) + '</small></h4>');

            //Add the episode title
            elEpisodeBody.append('<h4 class="media-heading"><span class="episodeNumber"> ' + episode.number + ': ' + episode.title + '</span></h4>');

            //This date will show on small mobile screens
            elEpisodeBody.append('<h4 class="hidden-sm hidden-md hidden-lg media-date visible-xs-*"><small>' + dateModified(episode.dateModified) + '</small></h4>');

            //Add a publish button if this is an un-published episode
            //Note if it's published or not
            if (episode.published) {
                elEpisodeBody.append('<a class="btn pull-right btn-unpublish" href="#"> Un-publish</a>');
            } else {
                elEpisodeBody.append('<a class="btn btn-default btn-success pull-right btn-publish" href="#"> Publish</a>');
                elEpisodeBody.append('<a class="btn btn-default btn-danger pull-right btn-delete" href="#"> Delete</a>');
            }

            //Add a description
            elEpisodeBody.append('<p class="description hidden-xs">' + episode.description + '</p>');

            //Add the media player TODO: the type attribute here should be calculated server side
            elEpisodeBody.append('<audio controls="true"><source src="' + episode.mediafile + '" type="audio/mpeg"></audio>');

            //Script & Shownotes controls
            elEpisodeBody.append('<h4 class="showEditControls"></h4>');
            elEpisodeBody.find('.showEditControls').append('<a class="btn btn-default editScript" href="/script?sh=' + show._id + '&ep=' + episode.number + '"> Script</a> ');
            elEpisodeBody.find('.showEditControls').append('<a class="btn btn-default editShownotes" href="/shownotes?sh=' + show._id + '&ep=' + episode.number + '"> Shownotes</a> ');

            console.log("EPISODE: " + episode);
        }
    }

    function removeMediaRowsFromEpisodeGallery(elEpisodeGallery) {
        console.log("removeMediaRowsFromEpisodeGallery()");
        return elEpisodeGallery.find('div.row.mediarow').remove();
    }

    function setCurrentFeedUrl(url) {
        return $('a#showFeedUrl').attr('href', url);
    }

    function getNextEpisodeNumber() {
        console.log(env);
        if (env.gEpisodes[0]) {
            return +env.gEpisodes[0].number + 1;
        }
        return 1;
    }

    function addEpisodeToGuide(showname, number, title, link, description, explicit, albumart, mp3url, published) {
        var pubstatus = "unpublished";
        var pubbtnclass = "btn-publish btn-success";
        var pubbtntext = "Publish";
        var savedate = moment().format('MMMM Do YYYY, h:mm:ss a');
        var medialist = 'div#episodeList .mediarow.' + showname + ' ul.media-list';
        var liEpisodeSelector = 'li.media.episode' + number;

        if (published) {
            pubstatus = "published";
            pubbtnclass = "btn-unpublish";
            pubbtntext = "Un-publish";
        }

        $(medialist).prepend('<li class="media ' + pubstatus + ' episode' + number + '"></li>');
        var liEpisode = $(medialist).find(liEpisodeSelector);

        liEpisode.append('<a class="pull-left" href="#"><img class="media-object" src="' + albumart + '" height="128" width="128"></a>');
        liEpisode.append('<div class="media-body"></div>');
        liEpisode.find('div.media-body').append('<h4 class="pull-right hidden-xs"><small>' + savedate + '</small></h4>');
        liEpisode.find('div.media-body').append('<h4 class="media-heading"><span class="episodeNumber">' + number + '</span>: ' + title + '</h4>');
        liEpisode.find('div.media-body').append('<h4 class="visible-xs-* hidden-sm hidden-md hidden-lg"><small>' + savedate + '</small></h4>');
        liEpisode.find('div.media-body').append('<a href="#" class="btn pull-right ' + pubbtnclass + '">' + pubbtntext + '</a> ');
        if (!published) {
            liEpisode.find('div.media-body').append('<a href="#" class="btn btn-default pull-right btn-danger btn-delete">Delete</a> ');
        }
        liEpisode.find('div.media-body').append('<p class="description hidden-xs">' + description + '</p>');
        liEpisode.find('div.media-body').append('<audio src="' + mp3url + '" controls=""></audio>');
        liEpisode.find('div.media-body').append('<h4 class="showEditControls"></h4>');
        liEpisode.find('div.media-body > h4.showEditControls').append('<a href="#" class="btn btn-default editScript">Script</a> ');
        liEpisode.find('div.media-body > h4.showEditControls').append('<a href="#" class="btn btn-default editShownotes">Shownotes</a> ');
    }

    function getCurrentShowId() {
        return $('a#dropdownShowSelector').data('mediarow');
    }

    /* Trigger an ID3 parse */
    function loadFromFile(file) {
        jsmediatags.read(file, {
            onSuccess: function (tag) {
                var tags = tag.tags;
                var startDate = new Date().getTime();
                jsmediatags.read(file, {
                    onSuccess: function (tag) {
                        var tags = tag.tags;
                        //alert(tags.artist + " - " + tags.title + ", " + tags.album);

                        $("div#newEpisodeForm input#inputEpisodeTitle").val(tags.title);
                        $("div#newEpisodeForm textarea#inputEpisodeDescription").text((tags.comment || {}).text || "");
                        if ("picture" in tags) {
                            var image = tags.picture;
                            var base64String = "";
                            for (var i = 0; i < image.data.length; i++) {
                                base64String += String.fromCharCode(image.data[i]);
                            }
                            var srcvalue = "data:" + image.format + ";base64," + window.btoa(base64String);
                            $("div#newEpisodeForm img.albumart").attr('src', srcvalue);
                            $("div#newEpisodeForm input#inputEpisodeAlbumArt").val(srcvalue);
                            console.log("DEBUG: Album art -> " + srcvalue);
                            $("div#newEpisodeForm img.albumart").style.display = "block";
                        }
                    }
                });
            }
        });
    }

    /* Load a file input image as a data url */
    function loadImageFileAsURL(file) {
        if (file) {
            var fileReader = new FileReader();

            fileReader.onload = function (fileLoadedEvent) {
                $('#newEpisodeForm img.albumart').attr('src', fileLoadedEvent.target.result);
                $('#newEpisodeForm input#inputEpisodeAlbumArt').attr("value", fileLoadedEvent.target.result);
            };

            fileReader.readAsDataURL(file);
        }
    }

    /* Is this object an image? */
    function isImage(url, type) {
        var type = (typeof type === "undefined") ? false : type;

        if (type) {
            if (type.indexOf('image') != -1) {
                return true;
            }
        }
        if (url.indexOf('.jpg') != -1) {
            return true;
        }
        if (url.indexOf('.jpeg') != -1) {
            return true;
        }
        if (url.indexOf('.png') != -1) {
            return true;
        }
        if (url.indexOf('.gif') != -1) {
            return true;
        }

        return false;
    }

    /* Reset a form and all of its controls to baseline */
    function clearForm(e) {
        var form = $(e).find('form');
        var inputs = $(e).find('input');
        var textareas = $(e).find('textarea');
        var imgs = $(e).find('img');

        //clear form
        form[0].reset();

        //remove input values
        inputs.val('');

        //clear text areas
        textareas.empty();

        //remove image srcs
        imgs.attr('src', '');

        return true;
    }

    function dateModified(date) {
        return moment(date).format('MMMM Do @ h:mm a');
        //return new Date(date).toLocaleFormat('%B %e @ %l:%M %p');
    }

    function showLoadingScreen() {
        $('div#loading.container').show();
    }

    function hideLoadingScreen() {
        $('div#loading.container').hide();
    }

    function deleteEpisode(showId, episodeNumber) {
        var authToken = getAuthToken();
        var deferredObject = $.Deferred();
        //Ajax call
        $.ajax({
            method: "DELETE",
            url: "/api/v1/episode/" + showId + "/" + episodeNumber,
            headers: {
                'X-AuthToken': authToken
            }
        })
            .done(function (responseData) {
                if (responseData.status) {
                    deferredObject.resolve(responseData.showid, responseData.number);
                } else {
                    deferredObject.reject(responseData.description);
                }
            });
        //Return a promise
        return deferredObject.promise();
    }
});